<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bloc de Notas Personal</title>
  <style>
/* Modo oscuro */
body.dark-mode {
  background: #121212;
  color: #ddd;
}

body.dark-mode .container,
body.dark-mode .listado {
  background: #1e1e1e;
  box-shadow: 0 8px 16px rgba(255, 255, 255, 0.1);
  border-color: #444;
}

body.dark-mode .entrada {
  background: #2a2a2a;
  border-left-color: #e74c3c;
  color: #eee;
}

body.dark-mode input,
body.dark-mode button,
body.dark-mode select,
body.dark-mode textarea {
  background-color: #333;
  color: #eee;
  border-color: #555;
}

body.dark-mode #loginContainer {
  background: #1e1e1e;
  color: #ddd;
  box-shadow: 0 8px 16px rgba(255,255,255,0.1);
}

body.dark-mode #btnCerrarSesion {
  background-color: #c0392b;
  box-shadow: 0 2px 6px rgba(255,255,255,0.3);
}

/* Botón toggler modo oscuro/claro en esquina derecha abajo */
#themeToggle {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  cursor: pointer;
  z-index: 10000;
  user-select: none;
  display: flex;
  align-items: center;
  justify-content: center;
}

#themeToggle svg {
  width: 30px;
  height: 30px;
  fill: #e74c3c;
  transition: fill 0.3s ease;
}

#themeToggle.dark svg.sun {
  display: none;
}

#themeToggle.dark svg.moon {
  display: block;
}

#themeToggle:not(.dark) svg.sun {
  display: block;
}

#themeToggle:not(.dark) svg.moon {
  display: none;
}

    body {
      background: linear-gradient(to right, #f5f7fa, #c3cfe2);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
    }

    /* --- Login styles --- */
    #loginContainer {
      max-width: 400px;
      background: #fffbea;
      padding: 30px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      border-radius: 15px;
      margin: 100px auto;
    }
    #loginContainer input, #loginContainer button {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
      font-family: inherit;
    }
    #loginContainer button {
      background-color: #e74c3c;
      color: white;
      border: none;
      cursor: pointer;
    }
    #loginError {
      color: red;
      margin-top: 10px;
      font-weight: bold;
    }

    /* Contenedor para input de contraseña + botón */
    .password-wrapper {
      position: relative;
      width: 100%;
      max-width: 400px;
      margin-top: 15px;
    }
    .password-wrapper input[type="password"],
    .password-wrapper input[type="text"] {
      width: 100%;
      padding: 12px 44px 12px 12px; /* espacio para el botón ojo */
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-family: inherit;
    }
    .password-wrapper button {
      position: absolute;
      top: 50%;
      right: 12px;
      transform: translateY(-50%);
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888;
      transition: color 0.3s;
    }
    .password-wrapper button:hover {
      color: #e74c3c;
    }
    .password-wrapper button svg {
      width: 22px;
      height: 22px;
      stroke: currentColor;
      fill: none;
    }

    /* --- Your original styles --- */
    .main {
      display: none; /* oculto hasta login correcto */
      flex-wrap: wrap;
      max-width: 1200px;
      margin: 50px auto;
      gap: 30px;
      justify-content: center;
      display: flex;
      position: relative;
      padding-top: 60px; /* espacio para perfil y cerrar sesión */
    }

    .container {
      flex: 1;
      min-width: 350px;
      background: #fffbea;
      padding: 30px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      border-radius: 15px;
      border: 2px dashed #f9d342;
      position: relative;
    }

    .listado {
      flex: 1;
      min-width: 350px;
      max-height: 600px;
      overflow-y: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    h1 {
      text-align: center;
      color: #4b4b4b;
    }

    label {
      display: block;
      margin-top: 20px;
      font-weight: bold;
      color: #444;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
    }

    .mes {
      font-size: 20px;
      font-weight: bold;
      margin-top: 20px;
      color: #2c3e50;
    }

    .entrada {
      background: #f6f6f6;
      border-left: 5px solid #e74c3c; /* Rojo */
      margin: 10px 0;
      padding: 10px 15px;
      position: relative;
      border-radius: 8px;
    }

    .entrada:hover .eliminar {
      display: flex;
    }

    .eliminar {
      position: absolute;
      right: 10px;
      top: 10px;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-weight: bold;
      display: none;
      cursor: pointer;
      align-items: center;
      justify-content: center;
    }

/* Botón cerrar sesión fijo arriba derecha */
#btnCerrarSesion {
  position: fixed;
  top: 10px;
  right: 15px;
  background: #e74c3c;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  z-index: 1000;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  width: auto;
  white-space: nowrap;
}

/* Círculo foto perfil fijo arriba izquierda */
#perfilUsuario {
  position: fixed;
  top: 10px;
  left: 15px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  z-index: 1000;
  
  background-color: transparent; /* <- transparente por defecto */
}

/* Cuando NO hay imagen, se agrega fondo rojo para la letra */
#perfilUsuario.no-image {
  background-color: #e74c3c;
}

#imagenPerfil {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: none;
  border-radius: 50%;
}

#inputImagenPerfil {
  display: none;
}

#letraPerfil {
  display: none;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  color: white;
  font-size: 28px;
  font-weight: bold;
  text-transform: uppercase;
  user-select: none;
}

    /* Buscador */
    #buscadorNombre {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
      margin-bottom: 10px;
      margin-right: 0;
      margin-top: 10px;
    }
    body.dark-mode #buscadorNombre {
      background: #222;
      color: #eee;
      border-color: #555;
    }
  </style>
</head>
<div id="themeToggle" title="Cambiar modo claro/oscuro">
  <!-- Sol (modo claro) -->
  <svg class="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
    <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12zM12 4v-2M12 22v-2M4.22 4.22l-1.42-1.42M19.78 19.78l-1.42-1.42M2 12H0M24 12h-2M4.22 19.78l-1.42 1.42M19.78 4.22l-1.42 1.42"/>
  </svg>
  <!-- Luna (modo oscuro) -->
  <svg class="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" >
    <path d="M21 12.79A9 9 0 0 1 12.21 3 7 7 0 1 0 21 12.79z"/>
  </svg>
</div>

<body>
  <!-- LOGIN -->
  <div id="loginContainer">
    <h2>Iniciar sesión</h2>
    <input type="email" id="email" placeholder="Usuario" required />
    <!-- Campo contraseña -->
    <input type="password" id="password" placeholder="Contraseña" required style="margin-top: 15px;" />
    <!-- Botón para mostrar/ocultar contraseña -->
    <div style="display: flex; justify-content: center; margin-top: 8px;">
      <button type="button" id="togglePassword" aria-label="Mostrar contraseña" style="
        background: none;
        border: none;
        cursor: pointer;
        color: #555;
        padding: 5px;
      ">
        <svg id="iconEye" xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
      </button>
    </div>
    <button id="btnLogin">Entrar</button>
    <div id="loginError"></div>
  </div>

  <!-- BLOC DE NOTAS ORIGINAL -->
  <div class="main" id="blocNotas">
    <button id="btnCerrarSesion">Cerrar sesión</button>

    <div id="perfilUsuario" title="Cambiar foto de perfil">
      <img id="imagenPerfil" alt="Perfil" />
      <input type="file" id="inputImagenPerfil" accept="image/*" />
      <span id="letraPerfil"></span>
    </div>

    <div class="container">
      <h1>📝 Mi Bloc de Notas</h1>
      <form id="formulario">
        <label for="nombre">Nombre</label>
        <input type="text" id="nombre" name="nombre" placeholder="Escribe tu nombre..." required />

        <label for="fecha">Fecha</label>
        <input type="date" id="fecha" name="fecha" required />

        <label for="precio1">Plan Anterior</label>
        <input type="number" id="precio1" name="precio1" placeholder="Ej: 10.00" required />

        <label for="precio2">Plan Nuevo</label>
        <input type="number" id="precio2" name="precio2" placeholder="Ej: 20.00" required />

        <button type="submit">Guardar</button>
      </form>
    </div>

    <!-- BUSCADOR: VA JUSTO ARRIBA DEL LISTADO -->
    <input type="text" id="buscadorNombre" placeholder="Buscar por nombre..." autocomplete="off" />

    <div class="listado" id="listado">
      <h2>📌 Listado</h2>
    </div>
  </div>

<script>
  const loginContainer = document.getElementById('loginContainer');
  const blocNotas = document.getElementById('blocNotas');
  const btnLogin = document.getElementById('btnLogin');
  const loginError = document.getElementById('loginError');
  const btnCerrarSesion = document.getElementById('btnCerrarSesion');
  const perfilUsuario = document.getElementById('perfilUsuario');

  // Variables para controlar usuario
  let correoUsuario = '';

  // Mostrar login al inicio, ocultar bloc
  function mostrarLogin() {
    loginContainer.style.display = 'block';
    blocNotas.style.display = 'none';
    perfilUsuario.style.display = 'none';
    btnCerrarSesion.style.display = 'none';
  }
  // Mostrar bloc y ocultar login
  function mostrarBloc() {
    loginContainer.style.display = 'none';
    blocNotas.style.display = 'flex';
    perfilUsuario.style.display = 'flex';
    btnCerrarSesion.style.display = 'inline-block';
    cargarImagenPerfil();
  }

  btnLogin.addEventListener('click', () => {
    const emailVal = document.getElementById('email').value.trim().toLowerCase();
    const passVal = document.getElementById('password').value;

    if (!emailVal) {
      loginError.textContent = 'Por favor ingresa un correo válido.';
      return;
    }
    if (passVal !== 'Claro1') {
      loginError.textContent = 'Contraseña incorrecta.';
      return;
    }

    correoUsuario = emailVal;
    loginError.textContent = '';
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';

    cargarImagenPerfil();
    cargarDatosGuardados();
    mostrarBloc();
  });

  function cargarImagenPerfil() {
    if (correoUsuario) {
      const key = 'imagenPerfil_' + correoUsuario.trim().toLowerCase();
      const imgGuardada = localStorage.getItem(key);
      if (imgGuardada) {
        mostrarImagenPerfil(imgGuardada);
      } else {
        imagenPerfil.style.display = 'none';
        letraPerfil.style.display = 'flex';
        letraPerfil.textContent = correoUsuario.charAt(0).toUpperCase();
        perfilUsuario.classList.add('no-image');
      }
    }
  }

  function mostrarImagenPerfil(src) {
    imagenPerfil.src = src;
    imagenPerfil.style.display = 'block';
    letraPerfil.style.display = 'none';
    letraPerfil.textContent = '';
    perfilUsuario.classList.remove('no-image');
  }

  btnCerrarSesion.addEventListener('click', () => {
    correoUsuario = '';
    listado.innerHTML = '<h2>📌 Listado</h2>';
    imagenPerfil.style.display = 'none';
    letraPerfil.style.display = 'none';
    perfilUsuario.style.display = 'none';
    mostrarLogin();
  });

  // Guardar y cargar datos por usuario
  const formulario = document.getElementById('formulario');
  const listado = document.getElementById('listado');
  const meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

  // Para buscador:
  let datosOriginales = null;

  function crearEntrada(data, mes, orden) {
    const entrada = document.createElement('div');
    entrada.className = 'entrada';
    entrada.innerHTML = `
      <strong>${orden}. ${data.nombre}</strong><br/>
      Fecha: ${data.fecha}<br/>
      Plan Anterior: $${data.precio1}<br/>
      Plan Nuevo: $${data.precio2}
      <button class="eliminar">&times;</button>
    `;

    const eliminarBtn = entrada.querySelector('.eliminar');
    eliminarBtn.addEventListener('click', () => {
      entrada.remove();
      const mesDiv = document.getElementById('mes-' + mes);
      const entradas = mesDiv ? mesDiv.querySelectorAll('.entrada') : [];
      if (entradas.length === 0 && mesDiv) mesDiv.remove();
      guardarDatosGuardados();
      cargarDatosGuardados();
      aplicarFiltroNombre();
    });

    return entrada;
  }

  function guardarDatosGuardados() {
    const data = {};
    document.querySelectorAll('[id^="mes-"]').forEach(mesDiv => {
      const mes = mesDiv.id.replace('mes-', '');
      data[mes] = [];
      mesDiv.querySelectorAll('.entrada').forEach(entrada => {
        const lines = entrada.innerText.split('\n');
        const nombre = lines[0].split('. ')[1];
        const fecha = lines[1].replace('Fecha: ', '');
        const precio1 = lines[2].replace('Plan Anterior: $', '');
        const precio2 = lines[3].replace('Plan Nuevo: $', '');
        data[mes].push({ nombre, fecha, precio1, precio2 });
      });
    });
    localStorage.setItem('blocNotas_' + correoUsuario, JSON.stringify(data));
  }

  function cargarDatosGuardados() {
    listado.innerHTML = '<h2>📌 Listado</h2>';
    const guardado = localStorage.getItem('blocNotas_' + correoUsuario);
    if (guardado) {
      const datos = JSON.parse(guardado);
      datosOriginales = datos;
      Object.keys(datos).forEach(mes => {
        const mesDiv = document.createElement('div');
        mesDiv.id = 'mes-' + mes;
        mesDiv.innerHTML = `<div class="mes">${mes}</div>`;
        datos[mes].forEach((entradaData, index) => {
          const entrada = crearEntrada(entradaData, mes, index + 1);
          mesDiv.appendChild(entrada);
        });
        listado.appendChild(mesDiv);
      });
    } else {
      datosOriginales = null;
    }
  }

  // BUSCADOR POR NOMBRE
  function aplicarFiltroNombre() {
    const filtro = document.getElementById('buscadorNombre').value.trim().toLowerCase();
    if (!datosOriginales) return cargarDatosGuardados();

    listado.innerHTML = '<h2>📌 Listado</h2>';
    let hayCoincidencias = false;

    Object.keys(datosOriginales).forEach(mes => {
      const entradasFiltradas = datosOriginales[mes].filter(e => e.nombre.toLowerCase().includes(filtro));
      if (entradasFiltradas.length > 0) {
        hayCoincidencias = true;
        const mesDiv = document.createElement('div');
        mesDiv.id = 'mes-' + mes;
        mesDiv.innerHTML = `<div class="mes">${mes}</div>`;
        entradasFiltradas.forEach((entradaData, index) => {
          const entrada = crearEntrada(entradaData, mes, index + 1);
          mesDiv.appendChild(entrada);
        });
        listado.appendChild(mesDiv);
      }
    });
    if (!hayCoincidencias) {
      listado.innerHTML += '<div style="color:#999;text-align:center;font-weight:bold;margin-top:30px;">Sin resultados</div>';
    }
  }

  document.getElementById('buscadorNombre').addEventListener('input', aplicarFiltroNombre);

  mostrarLogin();

  // Perfil de usuario - cambiar imagen y guardar
  const imagenPerfil = document.getElementById('imagenPerfil');
  const inputImagenPerfil = document.getElementById('inputImagenPerfil');
  const letraPerfil = document.getElementById('letraPerfil');

  perfilUsuario.addEventListener('click', () => {
    inputImagenPerfil.click();
  });

  inputImagenPerfil.addEventListener('change', () => {
    const file = inputImagenPerfil.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        const imgData = e.target.result;
        mostrarImagenPerfil(imgData);
        guardarImagenPerfil(imgData);
      };
      reader.readAsDataURL(file);
    }
  });

 function guardarImagenPerfil(dataUrl) {
    if (correoUsuario) {
      const key = 'imagenPerfil_' + correoUsuario.trim().toLowerCase();
      localStorage.setItem(key, dataUrl);
    }
  }

  function cargarImagenPerfil() {
    if (correoUsuario) {
      const key = 'imagenPerfil_' + correoUsuario.trim().toLowerCase();
      const imgGuardada = localStorage.getItem(key);
      if (imgGuardada) {
        mostrarImagenPerfil(imgGuardada);
      } else {
        imagenPerfil.style.display = 'none';
        letraPerfil.style.display = 'flex';
        letraPerfil.textContent = correoUsuario.charAt(0).toUpperCase();
      }
    }
  }

  function mostrarImagenPerfil(src) {
    imagenPerfil.src = src;
    imagenPerfil.style.display = 'block';
    letraPerfil.style.display = 'none';
    letraPerfil.textContent = '';
  }

  // Toggle mostrar/ocultar contraseña
  const togglePasswordBtn = document.getElementById('togglePassword');
  const passwordInput = document.getElementById('password');

  togglePasswordBtn.addEventListener('click', () => {
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    togglePasswordBtn.setAttribute('aria-label', type === 'password' ? 'Mostrar contraseña' : 'Ocultar contraseña');
    togglePasswordBtn.innerHTML = type === 'password' ? 
    `<svg id="iconEye" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
      <circle cx="12" cy="12" r="3"></circle>
    </svg>`
    : 
    `<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M17.94 17.94A10.05 10.05 0 0 1 12 20c-7 0-11-8-11-8a19.33 19.33 0 0 1 5-5"></path>
      <line x1="1" y1="1" x2="23" y2="23"></line>
    </svg>`;
  });

  const themeToggle = document.getElementById('themeToggle');

  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    themeToggle.classList.toggle('dark');
    if(document.body.classList.contains('dark-mode')){
      localStorage.setItem('theme', 'dark');
    } else {
      localStorage.setItem('theme', 'light');
    }
  });

  window.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme');
    if(savedTheme === 'dark'){
      document.body.classList.add('dark-mode');
      themeToggle.classList.add('dark');
    } else {
      document.body.classList.remove('dark-mode');
      themeToggle.classList.remove('dark');
    }
  });

  // Al guardar nueva entrada, actualizar filtro si hay texto en buscador
  formulario.addEventListener('submit', function(e) {
    e.preventDefault();
    const nombre = document.getElementById('nombre').value.trim();
    const fecha = document.getElementById('fecha').value;
    const precio1 = document.getElementById('precio1').value;
    const precio2 = document.getElementById('precio2').value;
    if (!nombre || !fecha) return;
    const mesNombre = meses[new Date(fecha).getMonth()];
    if (!datosOriginales) datosOriginales = {};
    if (!datosOriginales[mesNombre]) datosOriginales[mesNombre] = [];
    datosOriginales[mesNombre].push({ nombre, fecha, precio1, precio2 });
    localStorage.setItem('blocNotas_' + correoUsuario, JSON.stringify(datosOriginales));
    cargarDatosGuardados();
    if (document.getElementById('buscadorNombre').value.trim() !== "") {
      aplicarFiltroNombre();
    }
    formulario.reset();
  });
  <link rel="stylesheet" href="index.css">
<script src="index.js"></script>

</script>
</body>
</html>
